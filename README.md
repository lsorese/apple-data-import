# Apple Music Watch Album Analyzer

Analyzes your Apple Music play history to discover which albums you've completed while running on your Apple Watch.

## Quick Start

### Update Data (3 simple steps)

1. Download your latest Apple Music data from Apple
2. Copy the required CSV files to `apple-data-import/`:
   - `Apple Music Play Activity.csv`
   - `Apple Music - Container Details.csv`
3. Run the import script:
   ```bash
   ./import_apple_data.sh
   ```

See [QUICKSTART.md](QUICKSTART.md) for detailed instructions.

## Features

- **Apple Watch Focus**: Only shows albums played on Apple Watch
- **Completion Tracking**: Shows albums you've listened to ≥70% of tracks
- **Artist Information**: Combines data from Container Details to show artists
- **Date Tracking**: See when you first and last listened to each album
- **Year Filtering**: Filter albums by the year you last listened to them
- **Interactive Web Viewer**: Search, filter, and sort your running playlist

## Project Structure

```
.
├── analyze_music_watch.py       # Main analyzer (Apple Watch focused)
├── fetch_artists.py             # Optional: fetch missing artists from Apple API
├── import_apple_data.sh         # Simple data import script
├── apple-data-import/           # Place your Apple Music CSV files here
│   └── README.md
├── apple-music-watch-viewer/    # Web viewer (separate git repo)
│   └── public/
│       ├── index.html
│       └── data.json            # Generated by analyzer
├── QUICKSTART.md                # Step-by-step guide
└── README.md                    # This file
```

## How It Works

### Apple Watch Detection
Identifies Watch plays by checking:
- `Device Type` = "WATCH"
- `Device OS Name` = "WATCHOS"

### Album Completion
An album is "completed" (≥70%) when:
- You've listened to ≥70% of unique tracks in that album
- A track counts as "listened" if played for ≥50% of its duration

### Artist Matching
Artist names are extracted from `Apple Music - Container Details.csv`:
1. Parses "Artist - Album" format from Container Description
2. Falls back to Artists field when primary parsing fails
3. Optionally fetches missing artists via `fetch_artists.py`

## Configuration

Edit thresholds in `analyze_music_watch.py`:

```python
COMPLETION_THRESHOLD = 0.70  # 70% of tracks must be listened to
LISTEN_THRESHOLD = 0.50      # Track must be played for 50% of duration
```

## Optional: Fetch Missing Artists

Some albums may not have artist information. You can fetch them from Apple's API:

```bash
python3 fetch_artists.py
./import_apple_data.sh  # Re-run to include new artist data
```

Note: This may be slow due to API rate limits.

## Two Separate Git Repositories

This project has two independent git repositories:

1. **This repo** (scripts and data processing)
   - Python analysis scripts
   - Data import tools
   - Documentation

2. **apple-music-watch-viewer/** (web viewer)
   - Separate git repository
   - Deployed independently (e.g., to Vercel)
   - Consumes `data.json` generated by this repo

## View Your Data

After running the import:

```bash
# Open the viewer directly
open apple-music-watch-viewer/public/index.html

# Or run locally with npm
cd apple-music-watch-viewer
npm run dev
```

## Data Files

**Source files** (not in git):
- `Apple Music Play Activity.csv` (~90MB) - Your complete listening history
- `Apple Music - Container Details.csv` (~168KB) - Album and artist metadata

**Generated files** (not in git):
- `apple-music-watch-viewer/public/data.json` - Analysis output for web viewer
- `artist_mapping.json` - Cached artist lookups (if fetch_artists.py was run)

## Technical Details

- **Track completion**: `Play Duration` ≥ 50% of `Media Duration`
- **Album completion**: Unique tracks listened / Total unique tracks ≥ 70%
- **Date tracking**: Tracks first and last listen timestamps from Event End/Start Timestamp
- **Data refresh**: Re-run `import_apple_data.sh` to update with new listening data

## Scripts Reference

- `import_apple_data.sh` - Main import script (USE THIS)
- `analyze_music_watch.py` - Core analysis engine
- `fetch_artists.py` - Fetch missing artists from Apple API
- `update_data.sh` - Legacy update script (use import_apple_data.sh instead)
- `run_analysis.sh` - Legacy analyzer (use import_apple_data.sh instead)
- `serve.py` - Simple web server for local testing
- `test_api_rate.py` - Test Apple API rate limits
- `check_progress.sh` - Monitor fetch_artists.py progress

## License

MIT
